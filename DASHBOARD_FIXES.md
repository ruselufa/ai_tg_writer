# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞ Grafana

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω–µ–µ –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ **–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ** –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–∏–Ω—É—Ç–∞–º. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ:

- –ï—Å–ª–∏ –≤ 16:30 –±—ã–ª–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤, –∞ –≤ 16:31 –∏—Ö –Ω–µ –±—ã–ª–æ, –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–ª 10 –≤ 16:30 –∏ 10 –≤ 16:31
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (0 –∫–æ–≥–¥–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã), –Ω–æ –¥—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏ - –Ω–µ—Ç

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–∏–ª –∑–∞–ø—Ä–æ—Å—ã –≤ –¥–∞—à–±–æ—Ä–¥–µ —Å `increase(metric[5m])` –Ω–∞ `rate(metric[1m]) * 60` –¥–ª—è –º–µ—Ç—Ä–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

### –î–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```promql
increase(http_requests_total[5m])  # –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ 5 –º–∏–Ω—É—Ç
```

### –ü–æ—Å–ª–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```promql
rate(http_requests_total[1m]) * 60  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –º–∏–Ω—É—Ç—É
```

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –ø–∞–Ω–µ–ª—è–º

### 1. **HTTP Requests Rate** (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(http_requests_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(http_requests_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 2. **Voice Messages Rate** (—Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(voice_messages_processed_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(voice_messages_processed_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 3. **DeepSeek Tokens Rate** (—Ç–æ–∫–µ–Ω–æ–≤ –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(deepseek_tokens_used_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(deepseek_tokens_used_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 4. **Payments Rate** (–ø–ª–∞—Ç–µ–∂–µ–π –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(payments_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(payments_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 5. **Payment Errors Rate** (–æ—à–∏–±–æ–∫ –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(errors_total{type="payment"}[5m])`
- **–°—Ç–∞–ª–æ**: `rate(errors_total{type="payment"}[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 6. **Payment Amount Rate** (—Å—É–º–º–∞ –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(payment_amount_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(payment_amount_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—É–º–º—É –ø–ª–∞—Ç–µ–∂–µ–π –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

### 7. **API Errors Rate** (–æ—à–∏–±–æ–∫ –≤ –º–∏–Ω—É—Ç—É)
- **–ë—ã–ª–æ**: `increase(errors_total[5m])`
- **–°—Ç–∞–ª–æ**: `rate(errors_total[1m]) * 60`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

## üéØ –ú–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

### **Active Telegram Users** - –æ—Å—Ç–∞–ª—Å—è –∫–∞–∫ –µ—Å—Ç—å
- **–ó–∞–ø—Ä–æ—Å**: `telegram_active_users`
- **–ü—Ä–∏—á–∏–Ω–∞**: –≠—Ç–æ gauge –º–µ—Ç—Ä–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ –Ω–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ

### **Voice Processing Duration** - –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ —Å—Ä–µ–¥–Ω–µ–µ
- **–ë—ã–ª–æ**: `increase(voice_processing_duration_seconds[5m])`
- **–°—Ç–∞–ª–æ**: `rate(voice_processing_duration_seconds_sum[1m]) / rate(voice_processing_duration_seconds_count[1m])`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω—é—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

## üìà –ù–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏

### **Total Counts (accumulated)** - –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ —á–∞—Å: `increase(metric[1h])`
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### `rate()` —Ñ—É–Ω–∫—Ü–∏—è:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –º–µ—Ç—Ä–∏–∫–∏
- `rate(metric[1m])` = –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 1 –º–∏–Ω—É—Ç—É
- `* 60` = –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ "–∑–∞ –º–∏–Ω—É—Ç—É" –≤–º–µ—Å—Ç–æ "–∑–∞ —Å–µ–∫—É–Ω–¥—É"

### `increase()` —Ñ—É–Ω–∫—Ü–∏—è:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ** –∑–∞ –ø–µ—Ä–∏–æ–¥
- `increase(metric[5m])` = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞ 5 –º–∏–Ω—É—Ç

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
- **0** –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ—Ç
- **–†–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ** –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –∫–∞–∫ —É Active Users

–ü—Ä–∏–º–µ—Ä:
- 16:30: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 10
- 16:31: 0 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0
- 16:32: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 5

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana: http://localhost:3000
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∞—à–±–æ—Ä–¥ "AI TG Writer Monitoring - Fixed"
3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: `curl http://localhost:8080/test-metrics`
4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ, –∫–∞–∫ –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–∏–Ω—É—Ç–∞–º

# üóÑÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö AI TG Writer

## üìä –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üîó Database Connections (–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î)
- **–ú–µ—Ç—Ä–∏–∫–∏**: 
  - `pg_stat_database_numbackends` - –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - `pg_settings_max_connections` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ PostgreSQL
- **–ê–ª–µ—Ä—Ç—ã**: > 80% –æ—Ç max_connections - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### üíæ Database Size (–†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `pg_database_size_bytes / 1024 / 1024`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö
- **–ï–¥–∏–Ω–∏—Ü—ã**: MB
- **–ê–ª–µ—Ä—Ç—ã**: > 1GB - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, > 5GB - –∫—Ä–∏—Ç–∏—á–Ω–æ

### üîç Database Queries (–ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î)
- **–ú–µ—Ç—Ä–∏–∫–∏**:
  - `rate(pg_stat_database_tup_returned[5m])` - –≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–µ –∫–æ—Ä—Ç–µ–∂–∏/—Å–µ–∫
  - `rate(pg_stat_database_tup_fetched[5m])` - –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–æ—Ä—Ç–µ–∂–∏/—Å–µ–∫
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ï–¥–∏–Ω–∏—Ü—ã**: Tuples/sec

### üîí Database Locks (–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–î)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `pg_locks_count`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–æ —Ç–∏–ø–∞–º
- **–ê–ª–µ—Ä—Ç—ã**: > 100 –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### üíø Disk Space Usage (–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞)
- **–ú–µ—Ç—Ä–∏–∫–∏**:
  - `node_filesystem_size_bytes{mountpoint="/"} / 1024 / 1024` - –æ–±—â–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (MB)
  - `(node_filesystem_size_bytes - node_filesystem_avail_bytes) / 1024 / 1024` - –∑–∞–Ω—è—Ç–æ (MB)
  - `node_filesystem_avail_bytes{mountpoint="/"} / 1024 / 1024` - —Å–≤–æ–±–æ–¥–Ω–æ (MB)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö
- **–ï–¥–∏–Ω–∏—Ü—ã**: MB

### üéØ Database Cache Hit Ratio (–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∞)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `pg_stat_database_blks_hit / (pg_stat_database_blks_hit + pg_stat_database_blks_read) * 100`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–î–∏–∞–ø–∞–∑–æ–Ω**: 0-100%
- **–ê–ª–µ—Ä—Ç—ã**: < 95% - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, < 90% - –∫—Ä–∏—Ç–∏—á–Ω–æ

## üöÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ë–î

### 1. –ó–∞–ø—É—Å–∫ PostgreSQL Exporter:
```bash
docker-compose up -d postgres_exporter
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
docker-compose ps | grep postgres
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫:
```bash
curl http://localhost:9187/metrics | grep pg_stat_database | head -5
```

## üìà –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ Grafana: http://localhost:3000
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∞—à–±–æ—Ä–¥ "AI TG Writer Monitoring - Fixed"
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ –ø–∞–Ω–µ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–∞–Ω–µ–ª–∏ 19-24)

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã Prometheus

### –¢–æ–ø —Ç–∞–±–ª–∏—Ü –ø–æ —Ä–∞–∑–º–µ—Ä—É:
```promql
topk(5, pg_stat_user_tables_size_bytes)
```

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```promql
rate(pg_stat_database_tup_returned[5m]) / rate(pg_stat_database_tup_fetched[5m])
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:
```promql
rate(pg_stat_user_indexes_idx_tup_read[5m])
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
```promql
pg_stat_activity_count{state="active"}
```

## üö® –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–ª–µ—Ä—Ç—ã

### Database Connections:
- **Warning**: > 80% –æ—Ç max_connections
- **Critical**: > 95% –æ—Ç max_connections

### Database Size:
- **Warning**: > 1GB
- **Critical**: > 5GB

### Cache Hit Ratio:
- **Warning**: < 95%
- **Critical**: < 90%

### Disk Space:
- **Warning**: > 80% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
- **Critical**: > 90% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ

## üîç –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –ë–î –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ PostgreSQL Exporter**:
   ```bash
   curl http://localhost:9187/metrics | grep pg_stat_database
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**:
   ```bash
   docker-compose logs postgres_exporter
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Prometheus**:
   ```bash
   curl http://localhost:9090/api/v1/targets | grep postgres_exporter
   ```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã**:
   ```bash
   docker-compose restart postgres_exporter prometheus grafana
   ```

## üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### 1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- Cache Hit Ratio > 95%
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. **–†–µ—Å—É—Ä—Å—ã**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π < 80% –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞
- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞

### 3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ < 100
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- Deadlocks

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î

### –ü—Ä–∏ –Ω–∏–∑–∫–æ–º Cache Hit Ratio:
- –£–≤–µ–ª–∏—á–∏—Ç—å `shared_buffers`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `effective_cache_size`
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã

### –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:
- –£–≤–µ–ª–∏—á–∏—Ç—å `max_connections`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã

### –ü—Ä–∏ –±–æ–ª—å—à–æ–º —Ä–∞–∑–º–µ—Ä–µ –ë–î:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–∂–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
- –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ **6 –ø–∞–Ω–µ–ª–µ–π –ë–î** —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚úÖ **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** –≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∫—ç—à–∞
- ‚úÖ **–†–µ—Å—É—Ä—Å—ã** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- ‚úÖ **–ì–æ—Ç–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω!** üöÄ

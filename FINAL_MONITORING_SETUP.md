# üéØ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ AI TG Writer

## ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã:

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–∞–¥–∞—é—Ç –¥–æ 0** - —Ç–∞–π–º–∞—É—Ç 15 —Å–µ–∫—É–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **–ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–∏–Ω–∏–∏, –∞ –Ω–µ —Ç–æ—á–∫–∏** - –¥–æ–±–∞–≤–ª–µ–Ω `"lines": true, "points": false`
3. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∞ –Ω–µ rate** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `increase()` –≤–º–µ—Å—Ç–æ `rate()`
4. **–ü—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞ —É–±–∏—Ç—ã** - –ø–æ—Ä—Ç 8080 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω

### üìä –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏:

#### –í–µ—Ä—Ö–Ω–∏–π —Ä—è–¥:
- **HTTP Requests Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç
- **Voice Messages Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 5 –º–∏–Ω—É—Ç

#### –°—Ä–µ–¥–Ω–∏–π —Ä—è–¥:
- **Active Telegram Users** - —Ç–µ–∫—É—â–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø–∞–¥–∞–µ—Ç –¥–æ 0 —á–µ—Ä–µ–∑ 15 —Å–µ–∫)
- **Voice Messages Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 5 –º–∏–Ω—É—Ç
- **DeepSeek Tokens Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç
- **Payments Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç

#### –ù–∏–∂–Ω–∏–π —Ä—è–¥:
- **Voice Processing Duration** - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Payment Errors Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç
- **Payment Amount** - —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ 5 –º–∏–Ω—É—Ç
- **API Errors Count** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API –∑–∞ 5 –º–∏–Ω—É—Ç

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:

### 1. –ó–∞–ø—É—Å–∫ Docker (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω):
```bash
open -a Docker
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 —Å–µ–∫—É–Ω–¥
```

### 2. –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
docker-compose up -d prometheus grafana jaeger
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```bash
go run ./cmd/ai_tg_writer
```

### 4. –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º:
- **Grafana**: http://localhost:3000 (admin/admin)
- **Prometheus**: http://localhost:9090
- **Jaeger**: http://localhost:16686
- **Health Check**: http://localhost:8080/health
- **–ú–µ—Ç—Ä–∏–∫–∏**: http://localhost:8080/metrics

## üéØ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

### ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- **–†–µ–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∞–¥** - —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
- **–ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∏–∫–∏** - –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### ‚úÖ –°—á–µ—Ç—á–∏–∫–∏ –≤–º–µ—Å—Ç–æ rate:
- **HTTP Requests Count** - —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Voice Messages Count** - —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- **DeepSeek Tokens Count** - —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
- **Payments Count** - —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π

### ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ —Å –ª–∏–Ω–∏—è–º–∏:
- **–í—Å–µ –ø–∞–Ω–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–∏–Ω–∏–∏** - —É–¥–æ–±–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤
- **–ù–µ—Ç —Ç–æ—á–µ–∫** - —á–∏—Å—Ç—ã–π –≤–∏–¥ –≥—Ä–∞—Ñ–∏–∫–æ–≤
- **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** - –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å –ø–∏–∫–∏ –∏ —Å–ø–∞–¥—ã

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

### –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –Ω–∞ 5 –º–∏–Ω—É—Ç:
```go
// –í cmd/ai_tg_writer/main.go
monitoring.InitActiveUsersManager(5 * time.Minute)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –æ—á–∏—Å—Ç–∫–∏:
```go
// –í internal/monitoring/active_users.go
ticker := time.NewTicker(30 * time.Second) // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
```

## üìà –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ Prometheus:

```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç
increase(http_requests_total[5m])

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —á–∞—Å
increase(voice_messages_processed_total[1h])

# –¢–µ–∫—É—â–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
telegram_active_users

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ DeepSeek –∑–∞ –¥–µ–Ω—å
increase(deepseek_tokens_used_total[1d])

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç
increase(errors_total[5m])
```

## üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose restart

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
lsof -ti:8080
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

- **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–∞–¥–∞—é—Ç –¥–æ 0** —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
- **–ì—Ä–∞—Ñ–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–∏–Ω–∏–∏** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- **–°—á–µ—Ç—á–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞** –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏
- **–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

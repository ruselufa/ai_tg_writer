# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ AI TG Writer

## üéØ –°—Ç–∞—Ç—É—Å: –í–°–ï –ú–ï–¢–†–ò–ö–ò –†–ê–ë–û–¢–ê–Æ–¢!

### üìä –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

#### 1. ‚úÖ Voice Message Count (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `voice_messages_processed_total`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏—è**: 
  - `status="success",user_tariff="basic"`: 3
  - `status="success",user_tariff="premium"`: 3

#### 2. ‚úÖ Voice Message Duration (–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `voice_processing_duration_seconds`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–≠—Ç–∞–ø—ã**: `whisper`, `total`
- **–¢–∏–ø**: Histogram (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)

#### 3. ‚úÖ Payment Amount (–°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `payment_amount_total`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏—è**:
  - `provider="yookassa",status="success"`: 2970 —Ä—É–±–ª–µ–π
  - `provider="yookassa",status="pending"`: 5970 —Ä—É–±–ª–µ–π
  - `provider="prodamus",status="failed"`: 1500 —Ä—É–±–ª–µ–π

#### 4. ‚úÖ API Errors Count (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ API)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `errors_total`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏—è**:
  - `component="yookassa",type="payment"`: 3
  - `component="deepseek",type="api"`: 3
  - `component="whisper",type="voice"`: 3

#### 5. ‚úÖ Payment Errors Count (–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `errors_total{type="payment"}`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏–µ**: 3 –æ—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

#### 6. ‚úÖ Active Telegram Users (–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `telegram_active_users`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏–µ**: 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–∞–π–º–∞—É—Ç**: 15 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

#### 7. ‚úÖ DeepSeek Tokens (–¢–æ–∫–µ–Ω—ã DeepSeek)
- **–ú–µ—Ç—Ä–∏–∫–∞**: `deepseek_tokens_used_total`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- **–ó–Ω–∞—á–µ–Ω–∏—è**:
  - `type="input"`: 300 —Ç–æ–∫–µ–Ω–æ–≤
  - `type="output"`: 150 —Ç–æ–∫–µ–Ω–æ–≤
  - `type="total"`: 450 —Ç–æ–∫–µ–Ω–æ–≤

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
curl http://localhost:8080/test-metrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
curl http://localhost:8080/metrics

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
curl -s http://localhost:8080/metrics | grep voice_messages
curl -s http://localhost:8080/metrics | grep payment
curl -s http://localhost:8080/metrics | grep errors
curl -s http://localhost:8080/metrics | grep telegram_active_users
curl -s http://localhost:8080/metrics | grep deepseek
```

### üìà Grafana Dashboard

–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Grafana –¥–∞—à–±–æ—Ä–¥–µ:
- **URL**: http://localhost:3000
- **–õ–æ–≥–∏–Ω**: admin
- **–ü–∞—Ä–æ–ª—å**: admin

### üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

#### –ó–∞–ø—É—Å–∫:
```bash
./start_app.sh
```

#### –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
./stop_app.sh
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
ps aux | grep ai_tg_writer | grep -v grep
lsof -i :8080
```

### üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–µ—Ç—Ä–∏–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - —Ç–µ—Å—Ç–æ–≤—ã–π endpoint `/test-metrics` —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
2. **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥** - —Ç–∞–π–º–∞—É—Ç 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã** –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏** –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
5. **Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ Voice message count
- ‚úÖ Voice message duration  
- ‚úÖ Payment amount
- ‚úÖ API errors count
- ‚úÖ Payment errors count
- ‚úÖ Active Telegram users
- ‚úÖ DeepSeek tokens

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
